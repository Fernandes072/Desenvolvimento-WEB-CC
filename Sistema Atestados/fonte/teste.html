<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <title>Requerimento de Atestado</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
        <link rel="icon" href="icone2.png" type="image/x-icon">
        <link rel="stylesheet" href="estilo.css">
    </head>
    <body>
        <header id="main-header" class="mt-auto">
            <div class="col-xxl-6 col-xl-7 col-lg-8 col-md-9 col-12 rounded px-4 py-3">
                <div class="row">
                    <div class="col">
                        <img src="logo.png" alt="Logo" class="logo">
                    </div>
                    <div class="col mt-5">
                        <h1 class="titulo">Requerimento de Atestado</h1>
                    </div>
                </div>
            </div>
        </header>

        <main id="main-block">
            <form id="form-atestado" class="col-xxl-6 col-xl-7 col-lg-8 col-md-9 col-12 rounded px-4 py-3 ca-block">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="form-floating mb-2">
                                <input id="nome" name="nome" placeholder="Nome Completo" type="text" class="form-control" />
                                <label for="nome">Nome Completo<span class="asterisco-required"> *</span></label>
                                <div id="nome_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-floating mb-2">
                                <input id="matricula" name="matricula" placeholder="Matrícula" type="text" class="form-control" />
                                <label for="matricula">Matrícula<span class="asterisco-required"> *</span></label>
                                <div id="matricula_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-floating mb-2">
                                <input id="cpf" name="cpf" placeholder="CPF" type="text" class="form-control" />
                                <label for="cpf">CPF<span class="asterisco-required"> *</span></label>
                                <div id="cpf_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-floating mb-2">
                                <input id="email" name="email" placeholder="E-Mail" type="email" class="form-control" />
                                <label for="email">E-Mail<span class="asterisco-required"> *</span></label>
                                <div id="email_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-floating mb-2">
                                <input id="telefone" name="telefone" placeholder="Telefone" type="text" class="form-control" />
                                <label for="telefone">Telefone<span class="asterisco-required"> *</span></label>
                                <div id="telefone_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="mb-2">
                                <select class="form-select form-select-lg mb-3" id="curso" name="curso">
                                    <option value="" selected disabled>Curso<span class="asterisco-required"> *</span> </option>
                                    <option value="ccomp">Ciência da Computação</option>
                                    <option value="log">Logística</option>
                                    <option value="msi">Manutenção e Suporte em Informática</option>
                                    <option value="agro">Agronegócio</option>
                                </select>
                                <div id="curso_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-2">
                                <select id="turma" class="form-select form-select-lg mb-3" name="turma">
                                    <option value="" selected disabled>Turma<span class="asterisco-required"> *</span></option>
                                    <option value="1per">1° Período</option>
                                    <option value="2per">2° Período</option>
                                    <option value="3per">3° Período</option>
                                    <option value="4per">4° Período</option>
                                    <option value="5per">5° Período</option>
                                    <option value="6per">6° Período</option>
                                    <option value="7per">7° Período</option>
                                    <option value="8per">8° Período</option>
                                    <option value="1ano">1° Ano</option>
                                    <option value="2ano">2° Ano</option>
                                    <option value="3ano">3° Ano</option>
                                  </select>
                            </div>
                            <div id="turma_err" class="invalid-feedback"></div>
                        </div>
                    </div>
                    <div class="form-floating mb-2">
                        <textarea id="msg" name="msg" placeholder="Mensagem" class="form-control" rows="7" style="height: 100px"></textarea>
                        <label for="msg">Informações</label>
                        <div id="msg_err" class="invalid-feedback"></div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="mb-3">
                                <label for="arquivo" class="form-label"></label>
                                <input class="form-control formArquivo" type="file" id="arquivo">
                                <div id="arquivo_err" class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                <label class="form-check-label" for="flexCheckDefault">
                                    Deseja receber um email de confirmação?
                                </label>
                              </div>
                        </div>
                    </div>
                    <br>
                    <div class="d-md-block d-grid">
                        <input value="Enviar" type="submit" class="btn btn-primary" />
                    </div>
                </div>
            </form>
        </main>
        <script>
            validate = {
                /** Função para validar nomes. */
                nome: function(s)  {
                    let s_fmt = this.string_all_trim(s) // string formatada, tratada
                    if ( !s_fmt ) // check string vazia (ou null)
                        return false
                    if ( s_fmt.split(' ').length < 2 ) // check para nome e sobrenome
                        return false
                    return true
                },
                email: function(s) {
                    let regex_email = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,
                        s_fmt = this.string_all_trim(s)
                    if ( !regex_email.test(s_fmt) )
                        return false
                    return true
                },
                telefone: function(s) {
                    regex_telf = /^\d{2}\d{4,5}\d{4}$/
                    let s_fmt = this.string_all_trim(s)
                    if ( !regex_telf.test(s_fmt) )
                        return false
                    return true
                },
                curso: function(s) {
                    let select = document.getElementById('curso');
                    if (select.value == '')
                        return false
                    return true
                },
                msg: function(s) {
                    let s_fmt = this.string_all_trim(s)
                    if ( !s_fmt || s_fmt.length < 80 )
                        return false
                    return true
                },
                string_all_trim: function(s) {
                    if ( !s ) // é o mesmo que ( (s === null) || (s === '') )
                        return s
                    // s.replace(/\s+/,' '), substitui espaçamentos duplos ou mais por simples ' '
                    // s = s.replace(/^\s+|\s+$/,''), remove os espaçamentos antes ou depois da string
                    return s.replace(/\s+/g,' ').replace(/^\s+|\s+$/g,'')
                }
            }

            for (const id of ['nome', 'email', 'telefone', 'msg', 'curso']) {
                document.getElementById(id).addEventListener('change', (ev) => {
                    ev.target.value = validate.string_all_trim( ev.target.value )
                })
            }

            const main_form = document.getElementById('form-atestado')
            main_form.addEventListener( 'submit', (ev) => {
                const form_data = new FormData( main_form )
                console.log( JSON.stringify(Object.fromEntries(form_data)) )
                let msg_dict = {
                    'nome_err':'', 'email_err':'', 'telefone_err':'', 'curso_err':''}

                if ( !validate.nome(form_data.get('nome')) ){
                    msg_dict['nome_err'] = 'Nome inválido!'
                    document.getElementById('nome').classList.add('is-invalid')
                } else {
                    document.getElementById('nome').classList.remove('is-invalid')
                }
                    
                if ( !validate.email(form_data.get('email')) )
                    msg_dict['email_err'] = 'Email inválido!'
                if ( !validate.telefone(form_data.get('telefone')) )
                    msg_dict['telefone_err'] = 'Telefone inválido!'

                if ( !validate.curso(form_data.get('curso')) ){
                    msg_dict['curso_err'] = 'Selecione um curso!'
                    document.getElementById('curso').classList.add('is-invalid')
                } else {
                    document.getElementById('curso').classList.remove('is-invalid')
                }
                //
                let ok = true
                for (const [key, value] of Object.entries(msg_dict)) {
                    document.getElementById(key).innerText = value
                    if ( value.length > 0 )
                        ok = false
                }
                if ( ok )
                    return true
                ev.preventDefault()  // interrompe o submit no caso de erro no form
                ev.stopPropagation()
                return false
            })
        </script>
    </body>
</html>